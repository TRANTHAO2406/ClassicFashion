<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Chi tiết sản phẩm</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/navigation.css}">
<style>
    .selected {
        border: 2px solid #007bff;
        background-color: #e7f1ff;
    }
</style>
</head>
<body>
    <div th:replace="~{/fragment/navigation :: navigation}"></div>
    <div class="container-fluid" style="margin-top: 2rem">
        <form action="/shopping-cart/add" method="POST">
            <div class="row border-bottom mb-5">
                <div class="col-md-6">
                    <div th:each="detail : ${product.productDetails}">
                        <div th:if="${!#lists.isEmpty(detail.images)}">
                            <img th:src="@{${detail.images[0].imgLink}}" alt="Product Image" class="img-fluid" width="100%" height="100%" />
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <h2 th:text="${product.productName}" class="mt-4">Tên sản phẩm</h2>
                    
                    <!-- Chọn Màu Sắc -->
                    <div class="mb-3">
                        <div class="d-flex flex-wrap mb-2">
                            <div th:each="color : ${#sets.toSet(product.productDetails.![colorId.colorName])}">
                                <button type="button" class="btn btn-outline-success color-button mx-1"
                                    th:text="${color}" th:data-color="${color}"
                                    onclick="selectColor(this)"></button>
                            </div>
                        </div>
                    </div>

                    <!-- Chọn Kích Thước -->
                    <div class="mb-3">
                        <div class="d-flex flex-wrap">
                            <div th:each="size : ${#sets.toSet(product.productDetails.![sizeId.sizeName])}">
                                <button type="button" class="btn btn-outline-primary size-button mx-1"
                                    th:text="${size}" th:data-size="${size}"
                                    onclick="selectSize(this)"></button>
                            </div>
                        </div>
                    </div>

                    <!-- Các input ẩn để lưu color và size -->
                    <input type="hidden" name="color" id="selectedColor" />
                    <input type="hidden" name="size" id="selectedSize" />

                    <div class="mb-3">
                        <div class="input-group" style="max-width: 200px">
                            <div class="input-group-prepend">
                                <button class="btn btn-outline-secondary" type="button" id="decreaseBtn">-</button>
                            </div>
                            <input type="text" class="form-control text-center" value="1" id="quantityInput" name="quantity" />
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" id="increaseBtn">+</button>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" name="productId" th:value="${product.id}" />
                    <button type="submit" name="action" th:value="add" class="btn btn-danger btn-lg btn-block add-to-cart">Thêm vào giỏ hàng</button>
                    <button type="submit" name="action" th:value="buy" class="btn btn-success btn-lg btn-block buy-now">Mua ngay</button>
                </div>
            </div>
        </form>
    </div>

    <script>
        $(document).ready(function() {
            // Tăng giảm số lượng sản phẩm
            $('#increaseBtn').click(function() {
                let quantity = parseInt($('#quantityInput').val());
                if (!isNaN(quantity)) {
                    $('#quantityInput').val(quantity + 1);
                } else {
                    $('#quantityInput').val(1);
                }
            });

            $('#decreaseBtn').click(function() {
                let quantity = parseInt($('#quantityInput').val());
                if (!isNaN(quantity) && quantity > 1) {
                    $('#quantityInput').val(quantity - 1);
                }
            });
        });

        // Hàm chọn màu sắc
        function selectColor(element) {
            $('.color-button').removeClass('selected');
            $(element).addClass('selected');
            const selectedColor = $(element).data('color');
            $('#selectedColor').val(selectedColor);
        }

        // Hàm chọn kích thước
        function selectSize(element) {
            $('.size-button').removeClass('selected');
            $(element).addClass('selected');
            const selectedSize = $(element).data('size');
            $('#selectedSize').val(selectedSize);
        }
    </script>
</body>
</html>
